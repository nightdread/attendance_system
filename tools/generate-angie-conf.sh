#!/bin/bash

# ะกะบัะธะฟั ะดะปั ะณะตะฝะตัะฐัะธะธ angie.conf ะธะท ัะฐะฑะปะพะฝะฐ ั ะฟะตัะตะผะตะฝะฝัะผะธ ะพะบััะถะตะฝะธั

set -e

# ะะฐะณััะถะฐะตะผ ะฟะตัะตะผะตะฝะฝัะต ะธะท .env ัะฐะนะปะฐ (ะฑะตะท ะฒัะฟะพะปะฝะตะฝะธั ะบะพะผะฐะฝะด)
if [ -f ".env" ]; then
    export $(grep -v '^#' .env | xargs)
fi

# ะัะพะฒะตััะตะผ ะฝะฐะปะธัะธะต DOMAIN
if [ -z "$DOMAIN" ]; then
    echo "โ ะัะธะฑะบะฐ: ะฟะตัะตะผะตะฝะฝะฐั DOMAIN ะฝะต ัััะฐะฝะพะฒะปะตะฝะฐ!"
    echo "ะะพะฑะฐะฒััะต DOMAIN=your-domain.com ะฒ .env ัะฐะนะป"
    exit 1
fi

echo "๐ง ะะตะฝะตัะฐัะธั angie.conf ะดะปั ะดะพะผะตะฝะฐ: $DOMAIN"
echo "๐ ะัะฟะพะปัะทัะตะผ ัะฐะฑะปะพะฝ ะก Docker ะผะพะดัะปะตะผ"

# ะะฐะผะตะฝัะตะผ ัะพะปัะบะพ DOMAIN ะฒ ัะฐะฑะปะพะฝะต
sed "s/\${DOMAIN}/$DOMAIN/g" angie.conf.template > angie.conf

echo "โ angie.conf ัะณะตะฝะตัะธัะพะฒะฐะฝ ััะฟะตัะฝะพ!"
echo "๐ ะัะพะฒะตัััะต ัะฐะนะป: cat angie.conf"
