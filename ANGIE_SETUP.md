# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Angie (Nginx fork) —Å SSL

Angie –¥–æ–±–∞–≤–ª–µ–Ω –≤ docker-compose.yml –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è HTTPS —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –ø–æ—Ä—Ç 443.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è upstream –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

## üöÄ **–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

### üîí **SSL –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**
- HTTPS —Ç–æ–ª—å–∫–æ (–ø–æ—Ä—Ç 443)
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (TLS 1.2/1.3)
- Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (HSTS, CSP, X-Frame-Options)

### ‚ö° **–ù–∞–¥–µ–∂–Ω–∞—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∫–∞**
- –ü—Ä—è–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è upstream
- Keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç Docker API

## üìÅ –§–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- `angie.conf` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)
- `angie.conf.template` - —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Angie
- `generate-angie-conf.sh` - —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `ssl/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- `logs/angie/` - –ª–æ–≥–∏ Angie
- `docker-compose.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å Angie (—Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç 443 –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É)
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑**: `docker.angie.software/angie:latest`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–æ–º–µ–Ω –≤ .env —Ñ–∞–π–ª–µ

–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```bash
# –î–æ–º–µ–Ω –¥–ª—è Angie (HTTPS –ø—Ä–æ–∫—Å–∏)
DOMAIN=your-domain.com
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ `.env.example`:
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ DOMAIN –≤ .env —Ñ–∞–π–ª–µ
```


## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### –®–∞–≥ 2: –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é ssl/

```bash
# –ü–æ–ª–æ–∂–∏—Ç–µ –≤–∞—à–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é ssl/
cp /path/to/your/fullchain.pem ssl/
cp /path/to/your/privkey.pem ssl/
cp /path/to/your/chain.pem ssl/  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
chmod 644 ssl/fullchain.pem
chmod 600 ssl/privkey.pem
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ angie.conf (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:
```nginx
ssl_certificate /etc/ssl/certs/fullchain.pem;
ssl_certificate_key /etc/ssl/certs/privkey.pem;
```

–ï—Å–ª–∏ –≤–∞—à–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏–º–µ—é—Ç –¥—Ä—É–≥–∏–µ –∏–º–µ–Ω–∞ –∏–ª–∏ –ø—É—Ç–∏, –æ–±–Ω–æ–≤–∏—Ç–µ `angie.conf`.

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Angie –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞ `angie.conf.template` —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–î–ª—è —Ä—É—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
```bash
./generate-angie-conf.sh
```

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å Angie
docker-compose up -d

# –¢–æ–ª—å–∫–æ Angie
docker-compose up angie -d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Angie
docker-compose restart angie
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Angie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `angie.conf` –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Angie —Å –ø—Ä—è–º–æ–π –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∫–æ–π –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### –°—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∫–∞

Angie –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é upstream –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –ø–æ –∏–º–µ–Ω–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```nginx
upstream attendance_backend {
    server attendance_app:8000;
    keepalive 32;
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- Angie –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `attendance_app:8000` –ø–æ –∏–º–µ–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Docker —Å–µ—Ç–∏
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞—Ä—É–∂—É (—Ç–æ–ª—å–∫–æ –ø–æ—Ä—Ç 443 Angie)
- –í—Å–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤–Ω—É—Ç—Ä–∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π Docker —Å–µ—Ç–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ä—Ç—ã –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ø–æ–Ω—è—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø—Ä—è–º–∞—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∫–∞


## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Angie
./check-angie.sh

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ Angie
docker-compose logs angie

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Angie
docker-compose exec angie angie -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Angie –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥–∞
docker-compose exec angie angie -s reload
```

## üåê –î–æ—Å—Ç—É–ø

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à —Å–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
- **HTTPS:** https://your-domain.com

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞

–ù–µ –∑–∞–±—É–¥—å—Ç–µ:
1. –î–æ–±–∞–≤–∏—Ç—å A-–∑–∞–ø–∏—Å—å –≤ DNS: `your-domain.com ‚Üí –≤–∞—à_IP`
2. –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 443 –≤ firewall

## üõ† Troubleshooting

### "ssl certificate not found"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
ls -la ssl/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ volumes
docker-compose exec angie ls -la /etc/ssl/certs/
```

### "server_name not match"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –≤ angie.conf
grep server_name angie.conf
```

### Angie –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs angie

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec angie angie -t
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
cp new-fullchain.pem ssl/fullchain.pem
cp new-privkey.pem ssl/privkey.pem

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Angie
docker-compose exec angie angie -s reload
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f angie

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker-compose exec angie angie -s status
```
